<!DOCTYPE html>
<html>
<head>
    <title>Tur Sonucu</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1>ğŸ”„ Tur {{ tur }} Sonucu</h1>
            </div>

            <!-- Genel Mesaj -->
            <div class="evaluation-box">
                <h2>ğŸ“Š Genel Savunma DeÄŸerlendirmesi</h2>
                <p class="evaluation-message">{{ genel_mesaj }}</p>
            </div>

            <!-- Savunma SonuÃ§larÄ± -->
            <div class="real-time-results">
                <h2>ğŸ›¡ï¸ Savunma Ã–nlemleri SonuÃ§larÄ±</h2>

                {% for onlem in dogru_onlemler %}
                <div class="result-card basarili">
                    <div class="result-icon">âœ…</div>
                    <div class="result-content">
                        <h3>{{ onlem }}</h3>
                        <p>DoÄŸru Ã¶nlem uygulandÄ±.</p>
                    </div>
                </div>
                {% endfor %}

                {% for onlem in yanlis_onlemler %}
                <div class="result-card basarisiz">
                    <div class="result-icon">âŒ</div>
                    <div class="result-content">
                        <h3>{{ onlem }}</h3>
                        <p>YanlÄ±ÅŸ seÃ§im! Ek maliyet uygulanmÄ±ÅŸ olabilir.</p>
                        <p class="warning">ğŸ”» Ä°tibar kaybÄ± riski!</p>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Hasar Raporu -->
            {% if ek_maliyet > 0 %}
            <div class="damage-report">
                <h3>ğŸ’¸ Hasar Raporu</h3>
                <p>Ek Maliyet: ${{ ek_maliyet }}</p>
            </div>
            {% endif %}

            <!-- Skor Durumu -->
            <div class="score-board">
                <div class="score blue-score">
                    <h3>ğŸ”µ Blue Team</h3>
                    <p>Puan: {{ blue_puan }}</p>
                    <p>Kalan BÃ¼tÃ§e: ${{ blue_butce }}</p>
                </div>
                <div class="score red-score">
                    <h3>ğŸ”´ Red Team</h3>
                    <p>Puan: {{ red_puan }}</p>
                </div>
            </div>

            <!-- Ä°tibar Durumu -->
            <div class="reputation-box">
                <h3>â­ Ä°tibar Durumu</h3>
                <p class="reputation {{ itibar|lower|replace(' ', '-') }}">
                    {{ itibar }}
                </p>
            </div>

            <!-- Butonlar -->
           <div class="btn-container">
    {% if oyun_bitti_mi %}
        <a href="{{ url_for('result', room_id=room_id) }}" class="btn">ğŸ Oyun SonuÃ§larÄ±</a>
    {% elif role == "red" %}
        <a href="{{ url_for('game_room', room_id=room_id, role=role) }}" class="btn">â¡ï¸ Sonraki Tur</a>
    {% endif %}
</div>
        </div>
    </div>

    <!-- Blue Team iÃ§in yeni saldÄ±rÄ± algÄ±landÄ±ÄŸÄ±nda yÃ¶nlendirme -->
    <script>
        const socket = io();
        const room = "{{ room_id }}";
        const role = "{{ role }}";

        socket.emit('join', { room: room, role: role });

        if (role === "blue") {
            socket.on('attack_selected', data => {
                window.location.href = `/blue_defense/${room}/${role}`;
            });
        }
    </script>
</body>
</html>